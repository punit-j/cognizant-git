<!DOCTYPE html>
<html>
    <head>
        <title>User List</title>
        <style>
            table, td,th{
                border: solid 1px black;
            }
            #editDiv{
		display: none;
		height: fit-content;
		width: fit-content;
		background-color: grey;
		color: white;
		margin: auto;
		margin-top: 10%;
		border: solid 1px black;
            }
	    #info{
		display:none;
		width:100%;
		color:red;
		text-size:20mm;
	   }
	   #firstColumn{
	   	grid-column:1/ span 2;
	   }
	   #secondColumn{
	   	grid-column:2/ span 3;
	   }
        </style>    
    </head>
    <body>
        <table id="userTable" style="width: 100%;">
		<thead>
		<th>Id</th>
		<th>Name</th>
		<th>Username</th>
		<th>Email</th>
		<th>Company</th>
		<th></th>
		</thead>
		
		<tbody id="tableBody">
		</tbody>
        </table>
	<div id="info">
	<p>Item deleted succesfully</p>
	</div>
        <div id="editDiv">
            <form>
                <div id="firstColumn">Id:</div>
		<div id="secondColumn"> <input disabled id="id"></div>
                <div id="firstColumn">Name:</div> 
		<div id="secondColumn"><input id="name"></div>
                <div id="firstColumn">UserName:</div> 
		<div id="secondColumn"><input id="userName"></div>
                <div id="firstColumn">E-mail:</div> 
		<div id="secondColumn"><input id="email"></div>
                <div id="firstColumn">Company:</div> 
		<div id="secondColumn"><input id="company"></div>
                <div id="firstColumn"><button type = "button" onclick="editUser()">Submit</button></div>
                <div id="secondColumn"><button onclick="cancelEdit()">Cancel</button></div>
            </form>
        </div>
    </body>
    <script>
        var userList=[];
        fetchUser();
    function fetchUser(){
        fetch("https://jsonplaceholder.typicode.com/users")
        .then(response => response.json())
        .then((json) => {
            userList.push(json)
            userList=userList[0];
            iterateList(userList);
        })
    }

    function iterateList(userList){
        var list = "";
        for(i=0;i<userList.length;i++){
            list += `<tr> <td> ${userList[i].id} </td> <td> ${userList[i].name} </td> <td> ${userList[i].username} </td> <td> ${userList[i].email} </td> 
            <td> ${userList[i].company.name} </td> <td><button onclick="editUserDialogBox(${i})">edit</button><button onclick = "deleteUser(${i})">delete</button> </td></tr>`;
        }
        document.getElementById("tableBody").innerHTML = list;
        
    }
    function editUserDialogBox(index){
        document.getElementById("editDiv").style.display = 'grid';
        document.getElementById("userTable").style.display = 'none';
        var userToEdit = userList[index]
	document.getElementById("id").value=userToEdit.id;
	document.getElementById("name").value=userToEdit.name;
	document.getElementById("userName").value=userToEdit.username;
	document.getElementById("email").value=userToEdit.email;
	document.getElementById("company").value=userToEdit.company.name;
    }
    function deleteUser(index){
        fetch(`https://jsonplaceholder.typicode.com/users/${index+1}`, {
    	method: 'DELETE'   
        })
        userList.splice(index,1);
        iterateList(userList);
	document.getElementById("info").style.display = 'block';
	setTimeout(function(){document.getElementById("info").style.display = 'none';},5000);
    }
    function cancelEdit(){
        document.getElementById("editDiv").style.display = 'none';
        document.getElementById("userTable").style.display = 'block';
        iterateList(userList);
    }
    function editUser(){
        var id = document.getElementById("id").value;
        var user= {
            id: document.getElementById("id").value,
            name: document.getElementById("name").value,
            username: document.getElementById("userName").value,
            email: document.getElementById("email").value,
            company:{name: document.getElementById("company").value}
        }
        userList[id-1] = user;
        cancelEdit();
        fetch(`https://jsonplaceholder.typicode.com/users/${id}`,{
            method:`PUT`,
            body: JSON.stringify(obj)
        })
        .then(response=>response.json)
        .then(json=>console.log(json))
    }
    </script>
</html>